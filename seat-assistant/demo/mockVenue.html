<!-- demo/mockVenue.html
     A simple, parseable seat-booking page for your hackathon demo.
     - Seats are SVG circles with class="seat"
     - Required data-* attributes are included
     - Stage marker has id="stage"
     - Includes some sold + obstructed + aisle tags for realism
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mock Venue Seat Selection</title>
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        margin: 0;
        background: #0b0f19;
        color: #e8eefc;
      }
      header {
        padding: 16px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
      }
      header h1 {
        font-size: 16px;
        margin: 0;
        font-weight: 600;
        letter-spacing: 0.2px;
      }
      header .hint {
        font-size: 12px;
        opacity: 0.75;
      }
      .wrap {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 16px;
        padding: 16px;
      }
      .card {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        padding: 14px;
      }
      .legend {
        display: grid;
        gap: 10px;
        font-size: 12px;
      }
      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
      }
      .dot.avail {
        background: #6ee7b7;
      }
      .dot.sold {
        background: #64748b;
      }
      .dot.obstructed {
        background: #fb7185;
      }
      .dot.selected {
        background: #fde047;
      }
      .info {
        font-size: 12px;
        opacity: 0.85;
        line-height: 1.4;
      }
      .info code {
        background: rgba(255, 255, 255, 0.08);
        padding: 2px 6px;
        border-radius: 8px;
      }

      /* SVG seat map */
      svg {
        width: 100%;
        height: 78vh;
        display: block;
        border-radius: 14px;
        background: radial-gradient(
          1200px 600px at 50% 0%,
          rgba(56, 189, 248, 0.10),
          rgba(255, 255, 255, 0.02)
        );
      }
      .seat {
        cursor: pointer;
        stroke: rgba(255, 255, 255, 0.20);
        stroke-width: 1;
      }
      .seat[data-status="available"] {
        fill: rgba(110, 231, 183, 0.92);
      }
      .seat[data-status="sold"] {
        fill: rgba(100, 116, 139, 0.9);
        cursor: not-allowed;
      }
      .seat[data-tags*="obstructed"] {
        fill: rgba(251, 113, 133, 0.92);
      }
      .seat-selected {
        stroke: rgba(253, 224, 71, 1);
        stroke-width: 3;
        filter: drop-shadow(0 0 6px rgba(253, 224, 71, 0.55));
      }

      .section-label {
        font-size: 14px;
        opacity: 0.85;
        fill: rgba(232, 238, 252, 0.9);
        letter-spacing: 0.5px;
      }

      #stage {
        font-size: 16px;
        font-weight: 700;
        fill: rgba(232, 238, 252, 0.95);
        letter-spacing: 2px;
      }
      #stage-box {
        fill: rgba(99, 102, 241, 0.22);
        stroke: rgba(99, 102, 241, 0.6);
        stroke-width: 2;
        rx: 12;
        ry: 12;
      }
      .small {
        font-size: 11px;
        opacity: 0.85;
        fill: rgba(232, 238, 252, 0.8);
      }

      @media (max-width: 920px) {
        .wrap {
          grid-template-columns: 1fr;
        }
        svg {
          height: 70vh;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <h1>Mock Ticketing — Seat Selection</h1>
      <div class="hint">
        Tip: your extension can parse seats via <code>.seat</code> + <code>data-*</code>
      </div>
    </header>

    <div class="wrap">
      <div class="card">
        <svg id="seatmap" viewBox="0 0 1000 700" aria-label="Seat map">
          <!-- Stage -->
          <rect id="stage-box" x="340" y="30" width="320" height="70"></rect>
          <text id="stage" x="500" y="72" text-anchor="middle">STAGE</text>
          <text class="small" x="500" y="95" text-anchor="middle">
            (Speakers louder near front)
          </text>

          <!-- Section labels -->
          <text class="section-label" x="215" y="170" text-anchor="middle">SECTION A</text>
          <text class="section-label" x="500" y="170" text-anchor="middle">SECTION B</text>
          <text class="section-label" x="785" y="170" text-anchor="middle">SECTION C</text>

          <!-- Seats will be generated by JS below -->
          <g id="seats"></g>
        </svg>
      </div>

      <aside class="card">
        <div class="legend">
          <div class="chip"><span class="dot avail"></span> Available</div>
          <div class="chip"><span class="dot sold"></span> Sold</div>
          <div class="chip"><span class="dot obstructed"></span> Obstructed view</div>
          <div class="chip"><span class="dot selected"></span> Selected highlight</div>

          <div class="info">
            <div><b>Seat metadata:</b></div>
            <div>
              <code>data-section</code>, <code>data-row</code>, <code>data-seat</code>,
              <code>data-price</code>, <code>data-status</code>, <code>data-tags</code>
            </div>
            <br />
            <div><b>Tag examples:</b></div>
            <div><code>aisle</code>, <code>obstructed</code>, <code>wheelchair</code>, <code>near_exit</code></div>
            <br />
            <div><b>Pricing:</b></div>
            <div>Front rows (near stage): higher</div>
            <div>Section B: mid</div>
            <div>Farther rows: cheaper</div>
          </div>
        </div>
      </aside>
    </div>

    <script>
      // --------- Generate a predictable, parseable seat map ----------
      // Sections A, B, C in 3 blocks. Rows A-H, 15 seats per row per section.
      // Some seats are tagged aisle, obstructed, wheelchair, near_exit.
      // Some seats are sold.

      const svgNS = "http://www.w3.org/2000/svg";
      const seatsGroup = document.getElementById("seats");

      // Stage anchor coordinates (useful for your ranker)
      // Person 2 can export these from extractSeats.js or compute from #stage-box.
      const STAGE_ANCHOR = { x: 500, y: 65 };

      const sections = [
        { name: "A", x0: 120 },
        { name: "B", x0: 405 },
        { name: "C", x0: 690 },
      ];

      const rows = ["A", "B", "C", "D", "E", "F", "G", "H"]; // 8 rows
      const seatsPerRow = 15;

      // Layout
      const startY = 200;
      const rowGap = 48;
      const seatGap = 18;
      const seatRadius = 6;

      // Helper: create SVG circle seat
      function makeSeat({ cx, cy, section, row, seatNo, price, status, tags }) {
        const c = document.createElementNS(svgNS, "circle");
        c.setAttribute("class", "seat");
        c.setAttribute("r", String(seatRadius));
        c.setAttribute("cx", String(cx));
        c.setAttribute("cy", String(cy));

        c.setAttribute("data-section", section);
        c.setAttribute("data-row", row);
        c.setAttribute("data-seat", String(seatNo));
        c.setAttribute("data-price", String(price));
        c.setAttribute("data-status", status);
        c.setAttribute("data-tags", tags.join(","));

        // click selection for demo realism
        c.addEventListener("click", (e) => {
          if (c.getAttribute("data-status") !== "available") return;
          document.querySelectorAll(".seat-selected").forEach((el) => el.classList.remove("seat-selected"));
          c.classList.add("seat-selected");

          // In a real ticket page, selection might update a sidebar.
          // This helps your demo feel real.
          const msg = `Selected: Section ${section} Row ${row} Seat ${seatNo} ($${price})`;
          console.log(msg);
        });

        return c;
      }

      // Pricing heuristic: closer rows cost more; section A/C slightly cheaper than B
      function computePrice(section, rowIndex) {
        const frontPremium = Math.max(0, 7 - rowIndex) * 8; // more premium near front
        const base = section === "B" ? 120 : 110;
        return base + frontPremium;
      }

      // Tagging heuristic:
      // - Aisle: first or last seat in row
      // - Obstructed: a few random seats near the sides of section C
      // - Wheelchair: some seats at row H in section B
      // - Near_exit: row H edges in section A/C
      function computeTags({ section, rowIndex, seatNo }) {
        const tags = [];

        const isAisle = seatNo === 1 || seatNo === seatsPerRow;
        if (isAisle) tags.push("aisle");

        // near_exit seats: back row edges
        if (rowIndex === rows.length - 1 && isAisle) tags.push("near_exit");

        // wheelchair seats: section B, back row, middle area
        if (section === "B" && rowIndex === rows.length - 1 && seatNo >= 6 && seatNo <= 10) {
          tags.push("wheelchair");
        }

        // obstructed seats: some in section C, mid rows, far side
        if (section === "C" && rowIndex >= 3 && rowIndex <= 5 && (seatNo === 14 || seatNo === 15)) {
          tags.push("obstructed");
        }

        return tags;
      }

      // Sold heuristic: sprinkle some sold seats (deterministic)
      function isSold({ section, rowIndex, seatNo }) {
        // deterministic pattern so it’s repeatable
        const n = (section.charCodeAt(0) + rowIndex * 17 + seatNo * 13) % 23;
        return n === 0 || n === 7; // ~2/23 seats sold
      }

      // Generate all seats
      for (let s = 0; s < sections.length; s++) {
        const section = sections[s].name;
        const blockX = sections[s].x0;

        for (let r = 0; r < rows.length; r++) {
          const row = rows[r];
          const cy = startY + r * rowGap;

          // center the row around blockX
          const rowWidth = (seatsPerRow - 1) * seatGap;
          const startX = blockX + 30 - rowWidth / 2;

          for (let seatNo = 1; seatNo <= seatsPerRow; seatNo++) {
            const cx = startX + (seatNo - 1) * seatGap;

            const price = computePrice(section, r);
            const tags = computeTags({ section, rowIndex: r, seatNo });
            const sold = isSold({ section, rowIndex: r, seatNo });

            const status = sold ? "sold" : "available";
            const seatEl = makeSeat({
              cx,
              cy,
              section,
              row,
              seatNo,
              price,
              status,
              tags,
            });

            seatsGroup.appendChild(seatEl);
          }
        }
      }

      // Expose a tiny debug helper (optional)
      window.__MOCK_VENUE__ = {
        STAGE_ANCHOR,
        countSeats: () => document.querySelectorAll(".seat").length,
        countAvailable: () => document.querySelectorAll('.seat[data-status="available"]').length,
      };

      console.log("Mock venue loaded.");
      console.log("Total seats:", window.__MOCK_VENUE__.countSeats());
      console.log("Available seats:", window.__MOCK_VENUE__.countAvailable());
    </script>

    <script type="module">
      import { extractSeats, getStageAnchor } from "../seat/extractSeats.js";
      import { rankSeats, DEFAULT_WEIGHTS } from "../seat/rankSeats.js";
      import { selectSeat } from "../seat/selectSeat.js";

      window.extractSeats = extractSeats;
      window.rankSeats = rankSeats;
      window.DEFAULT_WEIGHTS = DEFAULT_WEIGHTS;
      window.getStageAnchor = getStageAnchor;
      window.selectSeat = selectSeat;

      console.log("Seat tools loaded.");
    </script>

  </body>
</html>
