<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mock Venue Seat Selection</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          sans-serif;
        margin: 0;
        background: #0b0f19;
        color: #e8eefc;
      }
      header {
        padding: 16px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
      }
      header h1 {
        font-size: 16px;
        margin: 0;
        font-weight: 600;
        letter-spacing: 0.2px;
      }
      .wrap {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 16px;
        padding: 16px;
      }
      .card {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        padding: 14px;
      }
      .legend {
        display: grid;
        gap: 10px;
        font-size: 12px;
      }
      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        display: inline-block;
      }
      .dot.avail {
        background: #6ee7b7;
      }
      .dot.sold {
        background: #64748b;
      }
      .dot.obstructed {
        background: #fb7185;
      }
      .dot.selected {
        background: #fde047;
      }

      .info {
        font-size: 12px;
        opacity: 0.85;
        line-height: 1.4;
      }
      .info code {
        background: rgba(255, 255, 255, 0.08);
        padding: 2px 6px;
        border-radius: 8px;
      }

      /* SVG seat map */
      svg {
        width: 100%;
        height: 78vh;
        display: block;
        border-radius: 14px;
        background: radial-gradient(
          1200px 600px at 50% 0%,
          rgba(56, 189, 248, 0.1),
          rgba(255, 255, 255, 0.02)
        );
      }
      .seat {
        cursor: pointer;
        stroke: rgba(255, 255, 255, 0.2);
        stroke-width: 1;
      }
      .seat[data-status="available"] {
        fill: rgba(110, 231, 183, 0.92);
      }
      .seat[data-status="sold"] {
        fill: rgba(100, 116, 139, 0.9);
        cursor: not-allowed;
      }
      .seat[data-tags*="obstructed"] {
        fill: rgba(251, 113, 133, 0.92);
      }
      .seat-selected {
        stroke: rgba(253, 224, 71, 1);
        stroke-width: 3;
        filter: drop-shadow(0 0 6px rgba(253, 224, 71, 0.55));
      }

      .section-label {
        font-size: 14px;
        opacity: 0.85;
        fill: rgba(232, 238, 252, 0.9);
        letter-spacing: 0.5px;
      }

      #stage {
        font-size: 16px;
        font-weight: 700;
        fill: rgba(232, 238, 252, 0.95);
        letter-spacing: 2px;
      }
      #stage-box {
        fill: rgba(99, 102, 241, 0.22);
        stroke: rgba(99, 102, 241, 0.6);
        stroke-width: 2;
        rx: 12;
        ry: 12;
      }
      .small {
        font-size: 11px;
        opacity: 0.85;
        fill: rgba(232, 238, 252, 0.8);
      }

      @media (max-width: 920px) {
        .wrap {
          grid-template-columns: 1fr;
        }
        svg {
          height: 70vh;
        }
      }
    </style>
  </head>

  <body>
    <header>
      <h1>Mock Ticketing â€” Seat Selection</h1>
    </header>

    <div class="wrap">
      <div class="card">
        <svg id="seatmap" viewBox="0 0 1000 700" aria-label="Seat map">
          <rect id="stage-box" x="340" y="30" width="320" height="70"></rect>
          <text id="stage" x="500" y="72" text-anchor="middle">STAGE</text>
          <text class="small" x="500" y="95" text-anchor="middle">
            (Speakers louder near front)
          </text>

          <text class="section-label" x="215" y="170" text-anchor="middle">
            SECTION A
          </text>
          <text class="section-label" x="500" y="170" text-anchor="middle">
            SECTION B
          </text>
          <text class="section-label" x="785" y="170" text-anchor="middle">
            SECTION C
          </text>

          <g id="seats"></g>
        </svg>
      </div>

      <aside class="card">
        <div class="legend">
          <div class="chip"><span class="dot avail"></span> Available</div>
          <div class="chip"><span class="dot sold"></span> Sold</div>
          <div class="chip">
            <span class="dot obstructed"></span> Obstructed view
          </div>
          <div class="chip">
            <span class="dot selected"></span> Selected highlight
          </div>

          <div class="info">
            <div><b>Pricing:</b></div>
            <div>Front rows (near stage): higher-priced seats</div>
            <div>Farther rows: lower-priced seats</div>
          </div>
        </div>
      </aside>
    </div>

    <script>
      const svgNS = "http://www.w3.org/2000/svg";
      const seatsGroup = document.getElementById("seats");
      const STAGE_ANCHOR = { x: 500, y: 65 };

      const sections = [
        { name: "A", x0: 120 },
        { name: "B", x0: 405 },
        { name: "C", x0: 690 },
      ];

      const rows = ["A", "B", "C", "D", "E", "F", "G", "H"];
      const seatsPerRow = 15;

      function makeSeat({ cx, cy, section, row, seatNo, price, status, tags }) {
        const c = document.createElementNS(svgNS, "circle");
        c.setAttribute("class", "seat");
        c.setAttribute("r", "6");
        c.setAttribute("cx", String(cx));
        c.setAttribute("cy", String(cy));
        c.setAttribute("data-section", section);
        c.setAttribute("data-row", row);
        c.setAttribute("data-seat", String(seatNo));
        c.setAttribute("data-price", String(price));
        c.setAttribute("data-status", status);
        c.setAttribute("data-tags", tags.join(","));

        c.addEventListener("click", () => {
          if (c.getAttribute("data-status") !== "available") return;
          document
            .querySelectorAll(".seat-selected")
            .forEach((el) => el.classList.remove("seat-selected"));
          c.classList.add("seat-selected");
          console.log(
            `Selected: Section ${section} Row ${row} Seat ${seatNo} ($${price})`,
          );
          announce(
            `Selected Section ${section}, Row ${row}, Seat ${seatNo}, Price $${price}`,
          );
        });

        return c;
      }

      function computePrice(section, rowIndex) {
        const frontPremium = Math.max(0, 7 - rowIndex) * 8;
        const base = section === "B" ? 120 : 110;
        return base + frontPremium;
      }

      function computeTags({ section, rowIndex, seatNo }) {
        const tags = [];
        const isAisle = seatNo === 1 || seatNo === seatsPerRow;
        if (isAisle) tags.push("aisle");
        if (rowIndex === rows.length - 1 && isAisle) tags.push("near_exit");
        if (
          section === "B" &&
          rowIndex === rows.length - 1 &&
          seatNo >= 6 &&
          seatNo <= 10
        )
          tags.push("wheelchair");
        if (
          section === "C" &&
          rowIndex >= 3 &&
          rowIndex <= 5 &&
          (seatNo === 14 || seatNo === 15)
        )
          tags.push("obstructed");
        return tags;
      }

      function isSold({ section, rowIndex, seatNo }) {
        const n = (section.charCodeAt(0) + rowIndex * 17 + seatNo * 13) % 23;
        return n === 0 || n === 7;
      }

      for (let s = 0; s < sections.length; s++) {
        const section = sections[s].name;
        const blockX = sections[s].x0;
        for (let r = 0; r < rows.length; r++) {
          const row = rows[r];
          const cy = 200 + r * 48;
          const rowWidth = (seatsPerRow - 1) * 18;
          const startX = blockX + 30 - rowWidth / 2;

          for (let seatNo = 1; seatNo <= seatsPerRow; seatNo++) {
            const cx = startX + (seatNo - 1) * 18;
            const price = computePrice(section, r);
            const tags = computeTags({ section, rowIndex: r, seatNo });
            const sold = isSold({ section, rowIndex: r, seatNo });
            const status = sold ? "sold" : "available";

            seatsGroup.appendChild(
              makeSeat({ cx, cy, section, row, seatNo, price, status, tags }),
            );
          }
        }
      }

      window.__MOCK_VENUE__ = { STAGE_ANCHOR };
    </script>

    <script src="../content.js"></script>
  </body>
</html>
